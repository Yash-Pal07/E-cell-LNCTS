;/*FB_PKG_DELIM*/

__d("EBFormatUtils",["I64","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a!=null)return(h||(h=d("I64"))).min(a,h.of_float(d("WATimeUtils").millisTime()));switch(b){case"before":return(h||(h=d("I64"))).of_float(d("WATimeUtils").millisTime());case"after":return(h||(h=d("I64"))).zero;default:b;return(h||(h=d("I64"))).max_int}}function b(a,b){switch(b){case"before":return[a,0];case"after":return[0,a];default:b;return[Math.ceil(a/2),Math.ceil(a/2)]}}g.adjustTs=a;g.adjustCount=b}),98);
__d("HiddenTabDataUtils",["vc-tracker","vulture"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){function d(){var d;return(d=c("vc-tracker")==null?void 0:c("vc-tracker").VisibilityState.getHiddenSpans(a,b))!=null?d:[]}function e(){var a=d();return a.length>0?a[0]:null}function f(){var a=0,b=d();b.forEach(function(b){a+=b.end-b.start});return Math.round(a)}function g(){c("vulture")("198w11GoV7ak9p-z7t-spEXBX6A=");var a=f();return a>0}function h(){var a;a=(a=c("vc-tracker")==null?void 0:c("vc-tracker").VisibilityState.getHiddenSpans(b-1,b))!=null?a:[];return a.length>0}function i(){c("vulture")("v5KScUi75y2ed1XG5sg7xQhSLYE=");var a=e();return a!=null?Math.round(a.end-a.start):0}function j(){var a=e();return a!=null?Math.round(a.start):null}function k(){var a=d();return a.length===0?null:Math.round(a[a.length-1].start)}return{firstTimeHidden:j,firstTimeHiddenDuration:i,isHidden:h,lastTimeHidden:k,totalHiddenTime:f,wasHidden:g}}g.getHiddenTabDataForTimeInterval=a}),98);
__d("IGDBundleResource",["cr:3823"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:3823")}),98);
__d("LSComputeParticipantCapabilities",["LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.filter(c.db.table(14).fetch([[[a[1],d[0]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,d[0])}).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[!1,!1],d[1]=c[0],d[2]=c[1],c):(b=a.item,c=[b.isAdmin==null?!1:b.isAdmin,b.isModerator],d[1]=c[0],d[2]=c[1])})},function(b){return c.filter(c.db.table(14).fetch([[[a[1],a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,a[0])}).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[!1,!1],d[4]=c[0],d[5]=c[1],c):(b=a.item,c=[b.isAdmin==null?!1:b.isAdmin,b.isModerator],d[4]=c[0],d[5]=c[1])})},function(b){return c.filter(c.db.table(7).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.id,a[0])&&c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))}).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=[c.i64.cast([0,1073741823]),c.i64.cast([0,0]),!1],d[7]=e[0],d[8]=e[1],d[9]=e[2],e):(b=a.item,e=[b.capabilities==null?c.i64.cast([0,1073741823]):b.capabilities,b.contactTypeExact==null?c.i64.cast([0,0]):b.contactTypeExact,b.isManagedByViewer==null?!1:b.isManagedByViewer],d[7]=e[0],d[8]=e[1],d[9]=e[2])})},function(a){return d[12]=c.i64.eq(d[8],c.i64.cast([0,4]))?d[9]?c.i64.cast([0,2612119]):c.i64.or_(c.i64.cast([0,2612119]),c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,3])))):d[7],c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[11]=a[0],a})},function(e){return d[13]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,20]))),d[15]=d[1]&&!d[4]&&c.i64.neq(d[11],a[0])?d[12]:c.i64.eq(c.i64.and_(d[12],d[13]),c.i64.cast([0,0]))?d[12]:c.i64.sub(d[12],d[13]),c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[14]=a[0],a})},function(e){return d[16]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,22]))),d[19]=d[4]&&d[1]&&c.i64.neq(d[14],a[0])?d[15]:c.i64.eq(c.i64.and_(d[15],d[16]),c.i64.cast([0,0]))?d[15]:c.i64.sub(d[15],d[16]),d[2]?d[17]=!(d[4]||d[5]):d[17]=!0,c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[18]=a[0],a})},function(b){return d[20]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,21]))),e[0]=(d[1]||d[2])&&d[17]&&c.i64.neq(a[0],d[18])?d[19]:c.i64.eq(c.i64.and_(d[19],d[20]),c.i64.cast([0,0]))?d[19]:c.i64.sub(d[19],d[20])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxComputeParticipantCapabilitiesStoredProcedure";a.__tables__=["participants","contacts"];e.exports=a}),null);
__d("LSAddParticipantIdToGroupThread",["LSComputeParticipantCapabilities"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.storedProcedure(b("LSComputeParticipantCapabilities"),a[1],a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.filter(c.db.table(14).fetch([[[a[0],a[1]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.contactId,a[1])&&c.i64.gt(b.authorityLevel,a[9])}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(14).put({threadKey:a[0],contactId:a[1],readWatermarkTimestampMs:a[2],readActionTimestampMs:a[3],deliveredWatermarkTimestampMs:a[4],nickname:a[5],normalizedSearchTerms:a[10],isAdmin:a[6],isSuperAdmin:a[13],subscribeSource:a[7],authorityLevel:a[9],participantCapabilities:d[0],groupParticipantJoinState:a[11],isModerator:a[12],threadRoles:a[14]}):0})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxAddParticipantIdToGroupThreadStoredProcedure";a.__tables__=["participants"];e.exports=a}),null);
__d("LSClearMessagePlaceholderRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(13).fetch([[[a[0],b.i64.cast([0,0])]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.minMessageId===a[1]&&b.i64.eq(b.i64.cast([0,0]),c.minTimestampMs)&&b.i64.eq(a[2],c.maxTimestampMs)}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxClearMessagePlaceholderRangeStoredProcedure";a.__tables__=["messages_ranges_v2__generated"];e.exports=a}),null);
__d("LSClearPinnedMessages",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(205).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxClearPinnedMessagesStoredProcedure";a.__tables__=["msg_pinned_messages_v2"];e.exports=a}),null);
__d("LSDeleteExistingMessageRanges",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(13).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteExistingMessageRangesStoredProcedure";a.__tables__=["messages_ranges_v2__generated"];e.exports=a}),null);
__d("LSDeleteThenInsertMessageRequest",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(34).put({threadKey:a[0],messageRequestStatus:a[2]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteThenInsertMessageRequestStoredProcedure";a.__tables__=["message_requests"];e.exports=a}),null);
__d("LSDeleteThenInsertThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(9).fetch([[[a[7]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?b.db.table(9).put({threadKey:a[7],lastReadWatermarkTimestampMs:a[1],authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:a[10],ongoingCallState:a[29],parentThreadKey:a[35],lastActivityTimestampMs:a[0],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteCallsExpireTimeMs:a[15],groupNotificationSettings:a[16],isAdminSnippet:a[17],snippetSenderContactId:a[18],snippetText:a[20],snippetStringHash:a[21],snippetStringArgument1:a[22],snippetAttribution:a[23],snippetAttributionStringHash:a[24],disappearingSettingTtl:a[25],disappearingSettingUpdatedTs:a[26],disappearingSettingUpdatedBy:a[27],cannotReplyReason:a[30],customEmoji:a[31],customEmojiImageUrl:a[32],outgoingBubbleColor:a[33],themeFbid:a[34],nullstateDescriptionText1:a[36],nullstateDescriptionType1:a[37],nullstateDescriptionText2:a[38],nullstateDescriptionType2:a[39],nullstateDescriptionText3:a[40],nullstateDescriptionType3:a[41],snippetHasEmoji:a[42],hasPersistentMenu:a[43],disableComposerInput:a[44],cannotUnsendReason:a[45],viewedPluginKey:a[46],viewedPluginContext:a[47],clientThreadKey:a[48],capabilities:a[49],shouldRoundThreadPicture:a[50],proactiveWarningDismissTime:a[51],isCustomThreadPicture:a[52],otidOfFirstMessage:a[53],normalizedSearchTerms:a[54],additionalThreadContext:a[55],disappearingThreadKey:a[56],isDisappearingMode:a[57],disappearingModeInitiator:a[58],unreadDisappearingMessageCount:a[59],lastMessageCtaId:a[61],lastMessageCtaType:a[62],consistentThreadFbid:a[63],threadDescription:a[64],unsendLimitMs:a[65],syncGroup:a[66],threadInvitesEnabled:a[67],threadInviteLink:a[68],numUnreadSubthreads:a[69],subthreadCount:a[70],threadInvitesEnabledV2:a[71],joinRequestApprovalSetting:a[72],pendingJoinRequestsCount:a[73],eventStartTimestampMs:a[74],eventEndTimestampMs:a[75],takedownState:a[76],memberCount:a[77],admodCount:a[78],secondaryParentThreadKey:a[79],igFolder:a[80],inviterId:a[81],threadTags:a[82],readReceiptsDisabledV2:a[83],threadStatus:a[84],threadSubtype:a[85],pauseThreadTimestamp:a[86],metadata:a[87],syncSource:a[88]}):(e=d.item,c[1]=e.lastActivityTimestampMs,c[3]=e.parentThreadKey,c[2]=e.disappearingThreadKey,c[4]=e.isDisappearingMode,b.i64.le(e.authorityLevel,a[6])?b.i64.gt(c[1],a[0])&&b.i64.neq(c[2],void 0)?(b.i64.eq(a[35],b.i64.cast([-1,4294967286]))&&b.i64.eq(c[3],b.i64.cast([0,0]))?(f=[c[3],e.folderName],c[5]=f[0],c[6]=f[1],f):(d=[a[35],a[10]],c[5]=d[0],c[6]=d[1],d),b.db.table(9).put({threadKey:a[7],lastReadWatermarkTimestampMs:e.lastReadWatermarkTimestampMs,authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:c[6],ongoingCallState:a[29],parentThreadKey:c[5],lastActivityTimestampMs:c[1],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteCallsExpireTimeMs:a[15],groupNotificationSettings:a[16],isAdminSnippet:a[17],snippetSenderContactId:a[18],snippetText:a[20],snippetStringHash:a[21],snippetStringArgument1:a[22],snippetAttribution:a[23],snippetAttributionStringHash:a[24],disappearingSettingTtl:a[25],disappearingSettingUpdatedTs:a[26],disappearingSettingUpdatedBy:a[27],cannotReplyReason:a[30],customEmoji:a[31],customEmojiImageUrl:a[32],outgoingBubbleColor:a[33],themeFbid:a[34],nullstateDescriptionText1:a[36],nullstateDescriptionType1:a[37],nullstateDescriptionText2:a[38],nullstateDescriptionType2:a[39],nullstateDescriptionText3:a[40],nullstateDescriptionType3:a[41],snippetHasEmoji:a[42],hasPersistentMenu:a[43],disableComposerInput:a[44],cannotUnsendReason:a[45],viewedPluginKey:a[46],viewedPluginContext:a[47],clientThreadKey:a[48],capabilities:a[49],shouldRoundThreadPicture:a[50],proactiveWarningDismissTime:a[51],isCustomThreadPicture:a[52],otidOfFirstMessage:a[53],normalizedSearchTerms:a[54],additionalThreadContext:a[55],disappearingThreadKey:c[2],isDisappearingMode:c[4],disappearingModeInitiator:a[58],unreadDisappearingMessageCount:a[59],lastMessageCtaId:a[61],lastMessageCtaType:a[62],consistentThreadFbid:a[63],threadDescription:a[64],unsendLimitMs:a[65],syncGroup:a[66],threadInvitesEnabled:a[67],threadInviteLink:a[68],numUnreadSubthreads:a[69],subthreadCount:a[70],threadInvitesEnabledV2:a[71],joinRequestApprovalSetting:a[72],pendingJoinRequestsCount:a[73],eventStartTimestampMs:a[74],eventEndTimestampMs:a[75],takedownState:a[76],memberCount:a[77],admodCount:a[78],secondaryParentThreadKey:a[79],igFolder:a[80],inviterId:a[81],threadTags:a[82],readReceiptsDisabledV2:a[83],threadStatus:a[84],threadSubtype:a[85],pauseThreadTimestamp:a[86],metadata:a[87],syncSource:a[88]})):b.db.table(9).put({threadKey:a[7],lastReadWatermarkTimestampMs:a[1],authorityLevel:a[6],mailboxType:a[8],threadType:a[9],folderName:a[10],ongoingCallState:a[29],parentThreadKey:a[35],lastActivityTimestampMs:a[0],snippet:a[2],threadName:a[3],threadPictureUrl:a[4],needsAdminApprovalForNewParticipant:a[5],threadPictureUrlFallback:a[11],threadPictureUrlExpirationTimestampMs:a[12],removeWatermarkTimestampMs:a[13],muteExpireTimeMs:a[14],muteCallsExpireTimeMs:a[15],groupNotificationSettings:a[16],isAdminSnippet:a[17],snippetSenderContactId:a[18],snippetText:a[20],snippetStringHash:a[21],snippetStringArgument1:a[22],snippetAttribution:a[23],snippetAttributionStringHash:a[24],disappearingSettingTtl:a[25],disappearingSettingUpdatedTs:a[26],disappearingSettingUpdatedBy:a[27],cannotReplyReason:a[30],customEmoji:a[31],customEmojiImageUrl:a[32],outgoingBubbleColor:a[33],themeFbid:a[34],nullstateDescriptionText1:a[36],nullstateDescriptionType1:a[37],nullstateDescriptionText2:a[38],nullstateDescriptionType2:a[39],nullstateDescriptionText3:a[40],nullstateDescriptionType3:a[41],snippetHasEmoji:a[42],hasPersistentMenu:a[43],disableComposerInput:a[44],cannotUnsendReason:a[45],viewedPluginKey:a[46],viewedPluginContext:a[47],clientThreadKey:a[48],capabilities:a[49],shouldRoundThreadPicture:a[50],proactiveWarningDismissTime:a[51],isCustomThreadPicture:a[52],otidOfFirstMessage:a[53],normalizedSearchTerms:a[54],additionalThreadContext:a[55],disappearingThreadKey:c[2],isDisappearingMode:c[4],disappearingModeInitiator:a[58],unreadDisappearingMessageCount:a[59],lastMessageCtaId:a[61],lastMessageCtaType:a[62],consistentThreadFbid:a[63],threadDescription:a[64],unsendLimitMs:a[65],syncGroup:a[66],threadInvitesEnabled:a[67],threadInviteLink:a[68],numUnreadSubthreads:a[69],subthreadCount:a[70],threadInvitesEnabledV2:a[71],joinRequestApprovalSetting:a[72],pendingJoinRequestsCount:a[73],eventStartTimestampMs:a[74],eventEndTimestampMs:a[75],takedownState:a[76],memberCount:a[77],admodCount:a[78],secondaryParentThreadKey:a[79],igFolder:a[80],inviterId:a[81],threadTags:a[82],readReceiptsDisabledV2:a[83],threadStatus:a[84],threadSubtype:a[85],pauseThreadTimestamp:a[86],metadata:a[87],syncSource:a[88]}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxDeleteThenInsertThreadStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSFlushSyncTrace",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(153).fetch(),function(c){return b.i64.eq(c.traceType,b.i64.cast([0,2]))&&c.contextOne===a[1]&&c.contextThree===a[0]}),function(a){var b=a.update;a.item;return b({shouldFlush:!0})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSDataTraceFlushSyncTraceStoredProcedure";a.__tables__=["data_trace_meta"];e.exports=a}),null);
__d("LSExecuteFinallyBlockForSyncTransaction",["LSFlushSyncTrace"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.filter(b.db.table(3).fetch([[["",a[1]]]]),function(c){return c.taskQueueName===""&&b.i64.eq(c.syncDatabaseId,a[1])&&b.i64.eq(c.epochId,a[2])}),function(c){var d=c.update;c=c.item;return d({epochId:!a[0]&&b.i64.eq(c.failureCount,b.i64.cast([-1,4294967295]))?c.epochId:void 0,failureCount:b.i64.eq(c.failureCount,b.i64.cast([-1,4294967295]))?b.i64.cast([0,0]):b.i64.add(c.failureCount,b.i64.cast([0,1]))})})},function(a){return b.resolve()}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreExecuteFinallyBlockForSyncTransactionStoredProcedure";a.__tables__=["network_requests"];e.exports=a}),null);
__d("LSExecuteFirstBlockForSyncTransaction",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSLogEventAnnotate.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.resolve()},function(e){return c.filter(c.db.table(3).fetch([[["",a[0]]]]),function(b){return b.taskQueueName===""&&c.i64.eq(b.syncDatabaseId,a[0])&&c.i64.eq(b.epochId,a[1])}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(b){return c.db.table(3).fetch([[["",a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.epochId)})},function(e){return d[4]=",",function(a){c.logger(a).mustfix(a)}(["epoch mismatch",d[4]," db_type=",d[4],c.i64.to_string(a[0]),d[4]," previous_cursor=",d[4],a[2]==null?"null":a[2],d[4]," next_cursor=",d[4],a[3],d[4]," server_epoch_id=",d[4],c.i64.to_string(a[1]),d[4]," client_epoch_id=",d[4],d[2]==null?"null":d[2]].join("")),d[5]=new c.Map(),d[5].set("database_id",a[0]),d[5].set("epoch_id",a[1]),d[5].set("sync_status",a[4]),d[5].set("next_cursor",a[3]),d[5].set("error_msg","epoch mismatch"),a[9]?d[6]=!1:d[6]=!0,d[6]?c.resolve():(d[8]=a[9].keys(),d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(e){return d[10]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[10]).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(b){return d[13]=a[9].get(d[11]),d[5].set(d[11],d[13])}])}):c.resolve())},function(a){return c.nativeOperation(b("LSLogEventAnnotate.nop"),c.i64.cast([0,16]),c.i64.cast([0,35]),c.i64.cast([0,0]),d[5])},function(a){return d[7]=!1,d[0]=d[7]}]):(e.item,c.sequence([function(e){return c.filter(c.db.table(1).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.groupId,a[0])&&b.currentCursor===a[2]}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(b){return c.db.table(3).fetch([[["",a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[4]=void 0:(b=a.item,d[4]=b.epochId)})},function(e){return d[6]=",",function(a){c.logger(a).mustfix(a)}(["cursor mismatch",d[6]," db_type=",d[6],c.i64.to_string(a[0]),d[6]," previous_cursor=",d[6],a[2]==null?"null":a[2],d[6]," next_cursor=",d[6],a[3],d[6]," server_epoch_id=",d[6],c.i64.to_string(a[1]),d[6]," client_epoch_id=",d[6],d[4]==null?"null":d[4]].join("")),d[7]=new c.Map(),d[7].set("database_id",a[0]),d[7].set("epoch_id",a[1]),d[7].set("sync_status",a[4]),d[7].set("next_cursor",a[3]),d[7].set("error_msg","cursor mismatch"),a[9]?d[8]=!1:d[8]=!0,d[8]?c.resolve():(d[10]=a[9].keys(),d[11]=c.i64.of_int32(d[10].length),c.i64.gt(d[11],c.i64.cast([0,0]))?c.loopAsync(d[11],function(e){return d[12]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[10],d[12]).then(function(a){return a=a,d[13]=a[0],d[14]=a[1],a})},function(b){return d[15]=a[9].get(d[13]),d[7].set(d[13],d[15])}])}):c.resolve())},function(a){return c.nativeOperation(b("LSLogEventAnnotate.nop"),c.i64.cast([0,16]),c.i64.cast([0,35]),c.i64.cast([0,0]),d[7])},function(a){return d[9]=!1,d[2]=d[9]}]):(e.item,c.sequence([function(b){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.of_float(Date.now()),c.forEach(c.db.table(1).fetch([[[a[0]]]]),function(b){var e=b.update;b.item;return e({currentCursor:a[3],syncStatus:a[4],sendSyncParams:a[5],minTimeToSyncTimestampMs:c.i64.eq(a[6],c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[4],a[6]),canIgnoreTimestamp:a[7],syncChannel:a[8],lastSyncCompletedTimestampMs:d[5]})})},function(b){return c.forEach(c.db.table(3).fetch([[["",a[0]]]]),function(a){var b=a.update;a.item;return b({failureCount:c.i64.cast([-1,4294967295])})})},function(e){return d[6]=new c.Map(),d[6].set("database_id",a[0]),d[6].set("epoch_id",a[1]),d[6].set("sync_status",a[4]),d[6].set("next_cursor",a[3]),a[9]?d[7]=!1:d[7]=!0,d[7]?c.resolve():(d[9]=a[9].keys(),d[10]=c.i64.of_int32(d[9].length),c.i64.gt(d[10],c.i64.cast([0,0]))?c.loopAsync(d[10],function(e){return d[11]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],d[11]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(b){return d[14]=a[9].get(d[12]),d[6].set(d[12],d[14])}])}):c.resolve())},function(a){return c.nativeOperation(b("LSLogEventAnnotate.nop"),c.i64.cast([0,16]),c.i64.cast([0,35]),c.i64.cast([0,0]),d[6])},function(a){return d[8]=!0,d[2]=d[8]}]))})},function(a){return d[0]=d[2]}]))})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreExecuteFirstBlockForSyncTransactionStoredProcedure";a.__tables__=["data_trace_meta","network_requests","sync_groups"];e.exports=a}),null);
__d("LSGetFirstAvailableAttachmentCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(a){return b.sequence([function(a){return b.db.table(19).fetchDesc().next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=b.i64.cast([0,1]):(d=a.item,c[0]=b.i64.add(d.ctaId,b.i64.cast([0,1])))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxGetFirstAvailableAttachmentCTAIDStoredProcedure";a.__tables__=["attachment_ctas"];e.exports=a}),null);
__d("LSInsertAttachmentCta",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(19).add({ctaId:a[0],attachmentFbid:a[1],attachmentIndex:a[2],threadKey:a[3],messageId:a[5],title:a[6],type_:a[7],platformToken:a[8],actionUrl:a[9],nativeUrl:a[10],urlWebviewType:a[11],actionContentBlob:a[12],enableExtensions:a[13],extensionHeightType:a[14],targetId:a[15]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxInsertAttachmentCtaStoredProcedure";a.__tables__=["attachment_ctas"];e.exports=a}),null);
__d("LSInsertAttachmentItem",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(18).add({attachmentFbid:a[0],attachmentIndex:a[1],threadKey:a[2],messageId:a[4],defaultActionEnableExtensions:a[31],originalPageSenderId:a[7],titleText:a[8],subtitleText:a[9],bodyText:a[12],playableUrl:a[13],playableUrlFallback:a[14],playableUrlExpirationTimestampMs:a[15],playableUrlMimeType:a[16],dashManifest:a[17],previewUrl:a[18],previewUrlFallback:a[19],previewUrlExpirationTimestampMs:a[20],previewUrlMimeType:a[21],previewWidth:a[22],previewHeight:a[23],imageUrl:a[24],defaultCtaId:a[25],defaultCtaTitle:a[26],defaultCtaType:a[27],defaultButtonType:a[29],defaultActionUrl:a[30],defaultWebviewHeightRatio:a[33],attachmentCta1Id:a[35],cta1Title:a[36],cta1IconType:a[37],cta1Type:a[38],attachmentCta2Id:a[40],cta2Title:a[41],cta2IconType:a[42],cta2Type:a[43],attachmentCta3Id:a[45],cta3Title:a[46],cta3IconType:a[47],cta3Type:a[48],faviconUrl:a[49],faviconUrlFallback:a[50],faviconUrlExpirationTimestampMs:a[51],previewUrlLarge:a[52]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxInsertAttachmentItemStoredProcedure";a.__tables__=["attachment_items"];e.exports=a}),null);
__d("LSInsertNewMessageRange",["LSClearMessagePlaceholderRange"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return c.storedProcedure(b("LSClearMessagePlaceholderRange"),a[0],a[9],c.i64.cast([0,0]))},function(b){return c.filter(c.db.table(13).fetch([[[a[0],{lte:a[5]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.le(b.minTimestampMs,a[5])&&c.i64.ge(b.maxTimestampMs,a[5])}).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[a[1],a[3],a[7]],d[0]=e[0],d[1]=e[1],d[2]=e[2],e):(c=b.item,e=[c.minTimestampMs,c.minMessageId,c.hasMoreBefore],d[0]=e[0],d[1]=e[1],d[2]=e[2])})},function(b){return c.filter(c.db.table(13).fetch([[[a[0],{lte:a[6]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.le(b.minTimestampMs,a[6])&&c.i64.ge(b.maxTimestampMs,a[6])}).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[a[2],a[4],a[8]],d[4]=e[0],d[5]=e[1],d[6]=e[2],e):(c=b.item,e=[c.maxTimestampMs,c.maxMessageId,c.hasMoreAfter],d[4]=e[0],d[5]=e[1],d[6]=e[2])})},function(b){return c.forEach(c.filter(c.db.table(13).fetch([[[a[0],{lte:a[6]}]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.ge(a[6],b.minTimestampMs)&&c.i64.le(a[5],b.maxTimestampMs)}),function(a){return a["delete"]()})},function(b){return c.db.table(13).put({threadKey:a[0],minTimestampMs:d[0],minMessageId:d[1],maxTimestampMs:d[4],maxMessageId:d[5],isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:d[2],hasMoreAfter:d[6]})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxInsertNewMessageRangeStoredProcedure";a.__tables__=["messages_ranges_v2__generated"];e.exports=a}),null);
__d("LSMailboxTaskCompletionApiOnTaskInsertion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.islc(b.db.table(232).fetch(),0,b.i64.to_float(b.i64.cast([0,1]))),function(c){c=c.item;return b.db.table(233).add({taskId:a[0],notificationScopeKey:c.notificationScopeKey,notificationName:c.notificationName})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreMailboxTaskCompletionApiOnTaskInsertionStoredProcedure";a.__tables__=["mailbox_task_completion_notification_context","mailbox_task_completion_api_tasks"];e.exports=a}),null);
__d("LSIssueNewTaskWithExtraOperations",["LSIssueNewTaskAndGetTaskID","LSMailboxTaskCompletionApiOnTaskInsertion"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[11]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskInsertion"),d[0])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreIssueNewTaskWithExtraOperationsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSOnSendMessageFailure.nop",["MWChatInteraction","Promise","err","justknobx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("sendToSentQPLLogger").__setRef("LSOnSendMessageFailure.nop");function a(a,d,e,f){if(!c("justknobx")._("1414"))return(h||(h=b("Promise"))).resolve();if(e==null)return(h||(h=b("Promise"))).resolve();var g=j(e);if(g==null)return(h||(h=b("Promise"))).resolve();c("promiseDone")(i.load().then(function(a){return a.markSendToSentFail(g,"send_message_server_error",c("err")("send_message_server_error: %s",f))}));return(h||(h=b("Promise"))).resolve()}function j(a){a=d("MWChatInteraction").get(d("MWChatInteraction").s2sKey(a));return a==null?null:Number(a)}a.__nop_name__="LSOnSendMessageFailure";g["default"]=a}),98);
__d("LSMarkOptimisticMessageFailed",["LSOnSendMessageFailure.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return a[2]===!0?d[0]=c.i64.cast([0,5]):d[0]=c.i64.cast([0,4]),a[2]===!0?d[1]=c.i64.cast([0,5]):d[1]=c.i64.cast([0,4]),a[2]===!0?d[2]=c.i64.cast([0,5]):d[2]=c.i64.cast([0,4]),c.nativeOperation(b("LSOnSendMessageFailure.nop"),a[0],a[1])},function(b){return c.forEach(c.filter(c.db.table(12).fetch([[[a[0]]],"optimistic"]),function(b){return b.offlineThreadingId===a[0]&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(a){var b=a.update;a.item;return b({sendStatus:d[0],sendStatusV2:d[1]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxMarkOptimisticMessageFailedStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSMarkOptimisticMessageFailedStoredProcedure",["LSMarkOptimisticMessageFailed","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSMarkOptimisticMessageFailed"),e.optimisticMid,e.errorMessage,e.isRetryable);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSetForwardScore",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.timestampMs,a[2])&&c.messageId===a[1]}),function(b){var c=b.update;b.item;return c({forwardScore:a[3]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxSetForwardScoreStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSSetMessageDisplayedContentTypes",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(d){return b.db.table(16).fetch([[[a[0],a[1]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?(d=[void 0,void 0],c[0]=d[0],c[1]=d[1],d):(b=a.item,d=[b.attachmentType,b.xmaLayoutType],c[0]=d[0],c[1]=d[1])})},function(d){return b.filter(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.timestampMs,a[2])&&c.messageId===a[1]}).next().then(function(a,d){var e=a.done;a=a.value;return e?(e=[b.i64.cast([0,0]),void 0,void 0],c[3]=e[0],c[4]=e[1],c[5]=e[2],e):(d=a.item,e=[d.replySourceTypeV2,d.replySourceId,d.text],c[3]=e[0],c[4]=e[1],c[5]=e[2])})},function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?c[7]=void 0:(b=a.item,c[7]=b.customEmoji)})},function(d){return b.i64.eq(c[0],b.i64.cast([0,6]))?c[9]=b.i64.cast([0,64]):(b.i64.eq(c[0],b.i64.cast([0,5]))?c[16]=b.i64.cast([0,4]):(b.i64.eq(c[0],b.i64.cast([0,3]))?c[17]=b.i64.cast([0,16384]):(b.i64.eq(c[0],b.i64.cast([0,2]))?c[18]=b.i64.cast([0,2]):(b.i64.eq(c[0],b.i64.cast([0,4]))?c[19]=b.i64.cast([0,2]):c[19]=a[5]?b.i64.cast([0,4096]):b.i64.cast([0,0]),c[18]=c[19]),c[17]=c[18]),c[16]=c[17]),c[9]=c[16]),c[10]=c[5]!==void 0&&c[5]!==""&&c[5]!==c[7]?b.i64.or_(c[9],b.i64.cast([0,1])):c[9],c[11]=c[7]!==void 0&&c[7]===c[5]?b.i64.or_(c[10],b.i64.cast([0,128])):c[10],c[12]=b.i64.eq(c[0],b.i64.cast([0,7]))?b.i64.or_(c[11],b.i64.cast([0,8])):c[11],c[13]=b.i64.eq(c[1],b.i64.cast([0,0]))?b.i64.or_(c[12],b.i64.cast([0,1024])):b.i64.eq(c[1],b.i64.cast([0,1]))?b.i64.or_(c[12],b.i64.cast([0,2048])):c[12],c[14]=b.i64.eq(c[3],b.i64.cast([0,2]))&&c[4]!==void 0?b.i64.or_(c[13],b.i64.cast([0,512])):c[13],c[15]=c[5]!==void 0&&c[5]!==""&&c[5]!==c[7]&&b.i64.eq(c[3],b.i64.cast([0,5]))?b.i64.or_(c[14],b.i64.cast([0,512])):c[14],b.forEach(b.filter(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.timestampMs,a[2])&&c.messageId===a[1]}),function(d){var e=d.update;d.item;return e({displayedContentTypes:a[4]?b.i64.cast([0,32]):b.i64.eq(c[3],b.i64.cast([0,3]))?b.i64.or_(c[15],b.i64.cast([0,8192])):c[15]})})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxSetMessageDisplayedContentTypesStoredProcedure";a.__tables__=["attachments","messages","threads"];e.exports=a}),null);
__d("LSSetRegionHint",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(1).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({regionHint:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreSetRegionHintStoredProcedure";a.__tables__=["sync_groups"];e.exports=a}),null);
__d("LSTruncateThreadRangeTablesForSyncGroup",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.i64.eq(a[0],b.i64.cast([0,1]))?b.forEach(b.filter(b.db.table(10).fetch(),function(a){return b.i64.eq(b.i64.cast([0,1])==null?b.i64.cast([0,1]):b.i64.cast([0,1]),b.i64.cast([0,1]))}),function(a){return a["delete"]()}):b.i64.eq(a[0],b.i64.cast([0,95]))?b.forEach(b.filter(b.db.table(10).fetch([[[b.i64.cast([0,0])],[b.i64.cast([-1,4294967295])]]]),function(a){return b.i64.eq(b.i64.cast([0,1])==null?b.i64.cast([0,1]):b.i64.cast([0,1]),b.i64.cast([0,1]))&&(b.i64.eq(a.parentThreadKey,b.i64.cast([0,0]))||b.i64.eq(a.parentThreadKey,b.i64.cast([-1,4294967295])))}),function(a){return a["delete"]()}):b.resolve(0)},function(c){return b.i64.eq(a[0],b.i64.cast([0,1]))?b.forEach(b.filter(b.db.table(247).fetch(),function(a){return b.i64.eq(a.syncGroup==null?b.i64.cast([0,1]):a.syncGroup,b.i64.cast([0,1]))}),function(a){return a["delete"]()}):b.resolve()},function(c){return b.forEach(b.db.table(198).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(c){return b.forEach(b.db.table(220).fetch([[[a[0]]]]),function(a){return a["delete"]()})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxTruncateThreadRangeTablesForSyncGroupStoredProcedure";a.__tables__=["threads_ranges_v2__generated","filtered_threads_ranges_v3__generated","inbox_threads_ranges","sync_group_threads_ranges"];e.exports=a}),null);
__d("LSTruncateTablesForSyncGroup",["LSTruncateThreadRangeTablesForSyncGroup"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(b){return c.forEach(c.filter(c.db.table(9).fetch(),function(b){return(c.i64.eq(b.syncGroup,a[0])||c.i64.eq(b.syncGroup,void 0)&&c.i64.eq(c.i64.cast([0,1]),a[0]))&&![c.i64.cast([0,17]),c.i64.cast([0,18]),c.i64.cast([0,19]),c.i64.cast([0,20]),c.i64.cast([0,21]),c.i64.cast([0,22]),c.i64.cast([0,23]),c.i64.cast([0,24]),c.i64.cast([0,25]),c.i64.cast([0,26]),c.i64.cast([0,27]),c.i64.cast([0,28])].some(function(a){return c.i64.eq(b.threadType,a)})}),function(a){return a["delete"]()})},function(d){return c.storedProcedure(b("LSTruncateThreadRangeTablesForSyncGroup"),a[0])}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxTruncateTablesForSyncGroupStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSUpdateAttachmentItemCtaAtIndex",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.i64.eq(a[5],b.i64.cast([0,0]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({defaultCtaId:a[2],defaultCtaTitle:a[3],defaultCtaType:a[4]})}):b.i64.eq(a[5],b.i64.cast([0,1]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({attachmentCta1Id:a[2],cta1Title:a[3],cta1Type:a[4],cta1IconType:void 0})}):b.i64.eq(a[5],b.i64.cast([0,2]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({attachmentCta2Id:a[2],cta2Title:a[3],cta2Type:a[4],cta2IconType:void 0})}):b.i64.eq(a[5],b.i64.cast([0,3]))?b.forEach(b.db.table(18).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({attachmentCta3Id:a[2],cta3Title:a[3],cta3Type:a[4],cta3IconType:void 0})}):b.resolve(function(a){b.logger(a).warn(a)}("Unexpected CTA index"))},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateAttachmentItemCtaAtIndexStoredProcedure";a.__tables__=["attachment_items"];e.exports=a}),null);
__d("LSUpdateReadReceipt",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(14).fetch([[[a[1],a[2]]]]),function(c){return b.i64.eq(c.threadKey,a[1])&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(c.contactId,a[2])&&b.i64.lt(c.readWatermarkTimestampMs,a[0])}),function(c){var d=c.update;c=c.item;return d({readWatermarkTimestampMs:a[0],readActionTimestampMs:b.i64.gt(a[3],b.i64.cast([0,0]))?a[3]:c.readActionTimestampMs})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateReadReceiptStoredProcedure";a.__tables__=["participants"];e.exports=a}),null);
__d("LSUpdateThreadsRangesV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(c){return b.forEach(b.db.table(10).fetch([[[a[1]]]]),function(a){return a["delete"]()})},function(d){return c[8]=b.i64.gt(a[2],b.i64.cast([0,1]))&&b.i64.gt(a[3],b.i64.cast([-2147483648,0])),a[0]==="inbox"&&b.i64.eq(a[1],b.i64.cast([0,0]))&&b.i64.eq(a[4],b.i64.cast([0,1]))?b.sequence([function(d){return c[9]=a[2],c[10]=a[3],c[11]=!1,c[12]=c[8],b.forEach(b.db.table(198).fetch(),function(a){a=a.item;return c[13]=a.minLastActivityTimestampMs,c[15]=a.minThreadKey,c[14]=b.i64.lt(c[9]==null?c[13]:c[9],c[13]),c[9]=c[14]?c[13]:c[9],c[10]=c[14]?c[15]:c[10],c[11]=c[11]||a.isLoadingBefore,c[12]=c[12]||b.i64.gt(c[13],b.i64.cast([0,1]))&&b.i64.gt(c[15],b.i64.cast([-2147483648,0]))})},function(a){return a=[c[9],c[10],c[11],c[12]],c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],a}]):b.resolve((d=[a[2],a[3],!1,c[8]],c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],d))},function(d){return b.i64.eq(a[4],b.i64.cast([0,1]))?b.sequence([function(d){return c[9]=c[0],c[10]=c[1],c[11]=c[2],c[12]=c[3],b.forEach(b.filter(b.db.table(220).fetch(),function(c){return b.i64.eq(c.parentThreadKey,a[1])}),function(a){a=a.item;return c[13]=a.minLastActivityTimestampMs,c[15]=a.minThreadKey,c[14]=b.i64.lt(c[9]==null?c[13]:c[9],c[13]),c[9]=c[14]?c[13]:c[9],c[10]=c[14]?c[15]:c[10],c[11]=c[11]||a.isLoadingBefore,c[12]=c[12]||b.i64.gt(c[13],b.i64.cast([0,1]))&&b.i64.gt(c[15],b.i64.cast([-2147483648,0]))})},function(a){return a=[c[9],c[10],c[11],c[12]],c[4]=a[0],c[5]=a[1],c[6]=a[2],c[7]=a[3],a}]):b.resolve((d=[c[0],c[1],c[2],c[3]],c[4]=d[0],c[5]=d[1],c[6]=d[2],c[7]=d[3],d))},function(d){return b.db.table(10).add({parentThreadKey:a[1],minThreadKey:c[5]==null?b.i64.cast([-2147483648,0]):c[5],minLastActivityTimestampMs:c[4]==null?b.i64.cast([0,1]):c[4],maxLastActivityTimestampMs:b.i64.cast([0,1]),maxThreadKey:b.i64.cast([-2147483648,0]),isLoadingBefore:c[6],isLoadingAfter:!1,hasMoreBefore:c[7],hasMoreAfter:!1})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxUpdateThreadsRangesV2StoredProcedure";a.__tables__=["threads_ranges_v2__generated","inbox_threads_ranges","sync_group_threads_ranges"];e.exports=a}),null);
__d("LSUpsertFolderSeenTimestamp",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.i64.gt(a[1],b.i64.cast([0,0]))?b.db.table(35).fetch([[[a[0]]]]).next().then(function(c,d){var e=c.done;c=c.value;return e?b.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:a[1]}):(d=c.item,b.i64.lt(d.lastSeenRequestTimestampMs,a[1])?b.forEach(b.db.table(35).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastSeenRequestTimestampMs:a[1]})}):b.resolve())}):b.resolve()},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertFolderSeenTimestampStoredProcedure";a.__tables__=["folder_metadata"];e.exports=a}),null);
__d("LSUpsertMessage",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(12).fetch([[[a[9]]],"optimistic"]).next().then(function(c,d){var e=c.done;c=c.value;return e?b.db.table(12).add({threadKey:a[3],timestampMs:a[5],messageId:a[8],offlineThreadingId:a[9],authorityLevel:a[2],primarySortKey:a[6],senderId:a[10],isAdminMessage:a[12],sendStatus:a[15],sendStatusV2:a[16],text:a[0],subscriptErrorMessage:a[1],secondarySortKey:a[7],stickerId:a[11],messageRenderingType:a[13],isUnsent:a[17],unsentTimestampMs:a[18],mentionOffsets:a[19],mentionLengths:a[20],mentionIds:a[21],mentionTypes:a[22],replySourceId:a[23],replySourceType:a[24],replySourceTypeV2:a[25],replyStatus:a[26],replySnippet:a[27],replyMessageText:a[28],replyToUserId:a[29],replyMediaExpirationTimestampMs:a[30],replyMediaUrl:a[31],replyMediaPreviewWidth:a[33],replyMediaPreviewHeight:a[34],replyMediaUrlMimeType:a[35],replyMediaUrlFallback:a[36],replyCtaId:a[37],replyCtaTitle:a[38],replyAttachmentType:a[39],replyAttachmentId:a[40],replyAttachmentExtra:a[41],replyType:a[42],isForwarded:a[43],forwardScore:a[44],hasQuickReplies:a[45],adminMsgCtaId:a[46],adminMsgCtaTitle:a[47],adminMsgCtaType:a[48],cannotUnsendReason:a[49],textHasLinks:a[50],viewFlags:a[51],displayedContentTypes:a[52],viewedPluginKey:a[53],viewedPluginContext:a[54],quickReplyType:a[55],hotEmojiSize:a[56],platformXmdEncoded:a[57],sendAttributionXmd:a[58],replySourceTimestampMs:a[59],ephemeralDurationInSec:a[60],msUntilExpirationTs:a[61],ephemeralExpirationTs:a[62],takedownState:a[63],isCollapsed:a[64],subthreadKey:a[65],botResponseId:a[66],metadataDataclass:a[67],editCount:a[68],isPaidPartnership:a[69],messageHiddenState:a[70],adminSignatureName:a[71],adminSignatureProfileUrl:a[72],adminSignatureCreatorType:a[73],replyMessageHiddenState:a[74],translatedText:a[75],textDialect:a[76],translatedTextDialect:a[77],scheduledTimestamp:a[78],isVideoQuickSend:a[79],subthreadParentMessageId:a[80],isExclusiveToSubthread:a[81]}):(d=c.item,b.i64.le(d.authorityLevel,a[2])?b.db.table(12).put({threadKey:a[3],timestampMs:a[5],messageId:a[8],offlineThreadingId:a[9],authorityLevel:a[2],primarySortKey:d.primarySortKey,senderId:a[10],isAdminMessage:a[12],sendStatus:a[15],sendStatusV2:a[16],text:a[0],subscriptErrorMessage:a[1],secondarySortKey:d.secondarySortKey,stickerId:a[11],messageRenderingType:a[13],isUnsent:a[17],unsentTimestampMs:a[18],mentionOffsets:a[19],mentionLengths:a[20],mentionIds:a[21],mentionTypes:a[22],replySourceId:a[23],replySourceType:a[24],replySourceTypeV2:a[25],replyStatus:a[26],replySnippet:a[27],replyMessageText:a[28],replyToUserId:a[29],replyMediaExpirationTimestampMs:a[30],replyMediaUrl:a[31],replyMediaPreviewWidth:a[33],replyMediaPreviewHeight:a[34],replyMediaUrlMimeType:a[35],replyMediaUrlFallback:a[36],replyCtaId:a[37],replyCtaTitle:a[38],replyAttachmentType:a[39],replyAttachmentId:a[40],replyAttachmentExtra:a[41],replyType:a[42],isForwarded:a[43],forwardScore:a[44],hasQuickReplies:a[45],adminMsgCtaId:a[46],adminMsgCtaTitle:a[47],adminMsgCtaType:a[48],cannotUnsendReason:a[49],textHasLinks:a[50],viewFlags:a[51],displayedContentTypes:a[52],viewedPluginKey:a[53],viewedPluginContext:a[54],quickReplyType:a[55],hotEmojiSize:a[56],platformXmdEncoded:a[57],sendAttributionXmd:a[58],replySourceTimestampMs:a[59],ephemeralDurationInSec:a[60],msUntilExpirationTs:a[61],ephemeralExpirationTs:a[62],takedownState:a[63],isCollapsed:a[64],subthreadKey:a[65],botResponseId:a[66],metadataDataclass:a[67],editCount:a[68],isPaidPartnership:a[69],messageHiddenState:a[70],adminSignatureName:a[71],adminSignatureProfileUrl:a[72],adminSignatureCreatorType:a[73],replyMessageHiddenState:a[74],translatedText:a[75],textDialect:a[76],translatedTextDialect:a[77],scheduledTimestamp:a[78],isVideoQuickSend:a[79],subthreadParentMessageId:a[80],isExclusiveToSubthread:a[81]}):b.resolve())})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertMessageStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSUpsertReaction",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(8).put({threadKey:a[0],messageId:a[2],actorId:a[3],timestampMs:a[1],reaction:a[4],authorityLevel:a[5],reactionCreationTimestampMs:a[6]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertReactionStoredProcedure";a.__tables__=["reactions"];e.exports=a}),null);
__d("LSUpsertSequenceId",["LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.i64.neq(a[1],void 0)?d[1]=a[1]:d[1]=d[0],c.db.table(25).put({id:d[1],lastAppliedMailboxSequenceId:a[0]})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpsertSequenceIdStoredProcedure";a.__tables__=["mailbox_metadata"];e.exports=a}),null);
__d("LSWriteThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(d,e){e=d.done;d=d.value;return e?0:(d.item,c[0]=b.i64.of_float(Date.now()),b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({capabilities:a[1],capabilities2:a[2],capabilities3:a[3],capabilities4:a[4],capabilities5:a[5]})}))})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxWriteThreadCapabilitiesStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("MAWBridgeFireAndForget",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge","MAWWaitForBackendSetup","MAWWorkerEvent","Promise","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("1143");function a(a,c,e,f){return d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){var g=d("MAWBridgeLoggingUtils").getBridgeEventInstanceKey(c);f!==!0&&d("MAWBridgeLoggingUtils").routeStart("fireAndForget",a,c,g);void d("MAWTimedBridge").bridgeTimeout(function(){return new(h||(h=b("Promise")))(function(b){d("MAWBridge").getBridge().fireAndForget(a,c,e,f,{onAck:function(e){f!==!0&&(d("MAWWorkerEvent").logAck(g,c,e),d("MAWBridgeLoggingUtils").routeSuccess(a,c,g)),b()},onSend:function(a){var b=a.queueMsgs;a=a.queueSize;f!==!0&&(d("MAWWorkerEvent").logSend(g,c,"fireAndForget"),d("MAWWorkerEvent").logAnnotations(g,{"int":{bridgeSize:a},string_array:{bridgeMsgs:b}}))}},{bridgeQPLInstanceKey:g})})},a,c,g,i)},c)}g.fireAndForget=a}),98);
__d("hasDefaultThreadOneToOneCapabilityDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";a=c("requireDeferred")("hasDefaultThreadOneToOneCapability").__setRef("hasDefaultThreadOneToOneCapabilityDeferred");g["default"]=a}),98);
__d("useCometMessengerhasDefaultThreadOneToOneCapability",["FBLogger","hasDefaultThreadOneToOneCapabilityDeferred","react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useEffect,j=b.useState;function a(a,b){var d=j(!1),e=d[0],f=d[1];i(function(){c("hasDefaultThreadOneToOneCapabilityDeferred").load().then(function(c){b==null?f(!1):c(b,a).then(function(a){f(a)})["catch"](function(){})})["catch"](function(a){c("FBLogger")("messenger_web").warn("Error loading hasDefaultThreadOneToOneCapability. %s",a)})},[a,e,b]);return e}g["default"]=a}),98);
__d("MAWThreadCutover",["I64","LSAuthorityLevel","LSContactBitOffset","LSDatabaseSingleton","LSMessagingThreadTypeUtil","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","MWPActor.react","MWPreloadableQueries","ReQL","ReQLSuspense","WAJids","asyncToGeneratorRuntime","useCometMessengerhasDefaultThreadOneToOneCapability","useMAWCanThreadBeCutoverOnDemand","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){var e=(j||(j=c("useReStore")))(),f=w(a);e=c("useCometMessengerhasDefaultThreadOneToOneCapability")(e,a);a=b!=null&&d("LSMessagingThreadTypeUtil").isGroup(b);return a?!0:f||e}function e(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield D(a))!=null});return k.apply(this,arguments)}function l(a){var b=(j||(j=c("useReStore")))();return d("ReQLSuspense").useFirst(function(){return a!=null?d("MWPreloadableQueries").getCutoverThreadByThreadKey(b,a):d("ReQL").empty()},[b,a],f.id+":62")!=null}function m(a){var b,e=(j||(j=c("useReStore")))();b=(b=d("ReQLSuspense").useFirst(function(){return a!=null?d("MWPreloadableQueries").getCutoverThreadByThreadKey(e,a):d("ReQL").empty()},[e,a],f.id+":74"))==null?void 0:b.showOpenMessageHistory;return b===!1}function n(a){a=v(a);return m(a)}function o(a,b){return d("ReQL").fromTableAscending(a.tables.mi_act_mapping_table).getKeyRange(b)}function p(a,b){return d("ReQL").fromTableAscending(a.tables.cutover_threads).filter(function(a){return(h||(h=d("I64"))).equal(a.armadilloThreadId,b)})}function q(a){var b=(j||(j=c("useReStore")))(),e=d("ReQLSuspense").useFirst(function(){return a==null?d("ReQL").empty():o(b,a)},[b,a],f.id+":112");return d("ReQLSuspense").useFirst(function(){return e==null?d("ReQL").empty():p(b,e.jid)},[b,e],f.id+":120")}function r(a,b){return d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(b.openThreadId)}function s(a){a=t(a);if(a==null||(h||(h=d("I64"))).lt(a.authorityLevel,(h||(h=d("I64"))).of_int32(c("LSAuthorityLevel").SERVER_PARTIAL)))return;return a}function t(a){var b=(j||(j=c("useReStore")))(),e=q(a);return d("ReQLSuspense").useFirst(function(){return e==null?d("ReQL").empty():r(b,e)},[b,e],f.id+":162")}function u(a){var b=(j||(j=c("useReStore")))(),e=d("ReQLSuspense").useFirst(function(){return a==null?d("ReQL").empty():o(b,a)},[b,a],f.id+":174"),g=e==null?void 0:e.jid;e=d("ReQLSuspense").useFirst(function(){return g!=null?d("ReQL").fromTableAscending(b.tables.threads).getKeyRange(g):d("ReQL").empty()},[b.tables.threads,g],f.id+":183");var h=c("useMAWCanThreadBeCutoverOnDemand")(g);return h?e:void 0}function v(a){a=q(a);if(a!=null)return a.openThreadId}function w(a){return q(a)!=null}function x(a,b){b=d("WAJids").threadIdForChatJid(b);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.cutover_threads).getKeyRange((h||(h=d("I64"))).of_string(b))).then(function(a){return a!=null})}function y(){var a=(j||(j=c("useReStore")))(),b=d("MWPActor.react").useActor();a=d("ReQLSuspense").first(d("ReQL").fromTableAscending(a.tables.contacts).getKeyRange(b),f.id+":223");return a!=null&&((b=d("LSContactBitOffset").has(75,a))!=null?b:!1)}function z(){var a=(j||(j=c("useReStore")))(),b=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(a.tables.experiences_shared_state).getKeyRange(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY)},[a],f.id+":238");b=d("MWEncryptedBackupsSharedState").getEntryValue({db:a,sharedStateRow:b,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY});return b!=null}function A(a){var b=(j||(j=c("useReStore")))(),e=a!=null?(h||(h=d("I64"))).of_string(a):void 0,g=l(e);return d("ReQLSuspense").useFirst(function(){if(g&&e!=null)return d("ReQL").fromTableAscending(b.tables.mi_act_mapping_table).filter(function(a){return(h||(h=d("I64"))).equal(a.jid,e)}).map(function(a){return(h||(h=d("I64"))).to_string(a.serverThreadKey)});else return d("ReQL").empty()},[b,e,g],f.id+":259")}function B(){return!0}function C(a){var b=(j||(j=c("useReStore")))(),e=d("ReQLSuspense").useFirst(function(){if(a!=null)return d("MWPreloadableQueries").getCutoverThreadByThreadKey(b,a);else return d("ReQL").empty()},[b,a],f.id+":286"),g=e==null?void 0:e.armadilloThreadId;e=d("ReQLSuspense").useFirst(function(){if(g!=null)return d("ReQL").fromTableAscending(b.tables.mi_act_mapping_table.index("jid")).getKeyRange(g);else return d("ReQL").empty()},[g,b.tables.mi_act_mapping_table],f.id+":297");return e==null?void 0:e.serverThreadKey}function D(a){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton),c=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.mi_act_mapping_table).getKeyRange(a)));if(c==null)return void 0;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.cutover_threads).filter(function(a){return(h||(h=d("I64"))).equal(a.armadilloThreadId,c.jid)})));return a});return E.apply(this,arguments)}g.useShouldHideE2eeAttribution=a;g.isCutoverThreadKey=e;g.useIsCutoverOpenThread=l;g.useIsDualThreadCutoverOpenThread=m;g.useIsDualThreadCutoverSecureThread=n;g.getMiActMappings=o;g.getCutoverThreadsByJid=p;g.useGetCutoverMapping=q;g.getThreadByCutoverThread=r;g.useOpenThreadIfExistsFromCutoverThread=s;g.useCutoverOpenThread=t;g.useODCutoverEligibleOpenOneToOneThread=u;g.useGetCutoverOpenThreadKey=v;g.useIsCutoverSecureThread=w;g.isCutoverSecureThreadFromChatJid=x;g.useIsCurrentUserCutoverUser=y;g.useGetHasUserRestoredBefore=z;g.useGetCutoverSecureThreadKey=A;g.useSupportedCutoverEnvironment=B;g.useCutoverSecureThreadKeyForOpenThreadKey=C;g.getCutoverThreadBySecureThreadKey=D}),98);
__d("useMAWCanThreadBeCutoverOnDemand",["LSContactBitOffset","LSMessagingThreadTypeUtil","MAWThreadCutover","ReQL","ReQLSuspense","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b,e=(h||(h=c("useReStore")))(),g=d("ReQLSuspense").useFirst(function(){return a!=null?d("ReQL").fromTableAscending(e.tables.contacts,d("LSContactBitOffset").contactCapabilityFields).getKeyRange(a):d("ReQL").empty()},[e,a],f.id+":34");g=g!=null&&d("LSContactBitOffset").has(76,g);var i=d("ReQLSuspense").useFirst(function(){return a!=null?d("ReQL").fromTableAscending(e.tables.threads,["threadType"]).getKeyRange(a):d("ReQL").empty()},[e,a],f.id+":53");i=i?d("LSMessagingThreadTypeUtil").isOpenOneToOne(i.threadType):!1;b=((b=(b=d("ReQLSuspense").useFirst(function(){return a!=null?d("ReQL").fromTableAscending(e.tables.messages_ranges_v2__generated,["minMessageId"]).getKeyRange(a):d("ReQL").empty()},[e,a],f.id+":67"))==null?void 0:b.minMessageId)!=null?b:"")==="";var j=d("MAWThreadCutover").useIsCutoverOpenThread(a),k=d("MAWThreadCutover").useIsCutoverSecureThread(a);j=j||k;return g&&i&&!b&&!j}g["default"]=a}),98);
__d("MAWThreadUtils",["LSIntEnum","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return a.threads.where("jid").equals(b).modify(c)}function b(a){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(){return(h||(h=d("LSIntEnum"))).ofNumber(16)},user:function(){return(h||(h=d("LSIntEnum"))).ofNumber(15)}});return a}g.updateThreadWithJid=a;g.getLSThreadTypeFromJid=b}),98);
__d("MessageSendsClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1271");b=d("FalcoLoggerInternal").create("message_sends_client",a);e=b;g["default"]=e}),98);
__d("MWLogSend",["ErrorGuard","FBLogger","I64","LSMessagingThreadTypeUtil","LSPlatformLsInitLog","MessageSendsClientFalcoEvent","MultipleTabsLogger","Promise","ReQL","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=[];function l(a){return function(){while(k.length>0)(j||(j=c("ErrorGuard"))).applyWithGuard(o,null,[a,k.shift(),!0])}}var m=!1;function n(a,b){k.push(b),m||(d("LSPlatformLsInitLog").onCompleteOrFail(l(a)),m=!0)}function o(a,e,f){e._mentionedJids;var g=e.actor,j=e.additionalTags,k=e.attachmentFbids,l=e.attachmentType,m=e.backend,o=e.ephemeralDurationInSec,p=e.hasReply,q=e.igdTargetType,r=e.initatingSource,s=e.isInstamadilloTTLC,t=e.messageSendDataclass,u=e.messagingThreadId,v=e.msgTtl,w=e.offlineThreadingId,x=e.sendType,y=e.source,z=e.threadKey,A=e.threadType;c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (i||(i=b("Promise"))).all([d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.participants).getKeyRange(z).filter(function(a){return!(h||(h=d("I64"))).equal(a.contactId,g)})),d("MultipleTabsLogger").hasMultipleTabs()]).then(function(b){var i=b[0];b=b[1];if(i==null){var B=d("LSPlatformLsInitLog").isPending();if(B&&f!==!0){n(a,e);return}f===!0&&c("FBLogger")("meteora").warn("LS_INIT completed but participants table is still empty.")}var C=i.map(function(a){return(h||(h=d("I64"))).to_string(a.contactId)});B=d("LSMessagingThreadTypeUtil").isOneToOne(A)&&(i==null?void 0:i.length)===0;B&&C.push((h||(h=d("I64"))).to_string(g));var D=u!=null?u:(h||(h=d("I64"))).to_string(z),E=v!=null?(h||(h=d("I64"))).to_string((h||(h=d("I64"))).of_float(v)):void 0,F=[b===!0?19:null,o!=null?15:null,s===!0?37:null].filter(Boolean);(D==null||D===""||(h||(h=d("I64"))).le(z,(h||(h=d("I64"))).zero))&&(e.waGroupJid!=null?c("FBLogger")("mw_log_send").mustfix("Thread FBID is null and recovered by chatJid in send flow - ThreadKey %s, messagingThreadId %s, send type %s",(h||(h=d("I64"))).to_string(z),u,x):c("FBLogger")("mw_log_send").mustfix("Thread FBID is null in send flow - ThreadKey %s, messagingThreadId %s, send type %s",(h||(h=d("I64"))).to_string(z),u,x));c("MessageSendsClientFalcoEvent").log(function(){return{additional_tags:j,backend:m,event_type:x,feature_tags:F,group_thread_subtype:void 0,igd_action:void 0,igd_target_type:q,igd_verb:void 0,initiating_app_id:void 0,initiating_source:r,is_reply:p,message_attachment_fbids:k.map(String),message_id:void 0,message_send_dataclass_logged:t,message_type:l,messaging_thread_fbid:D,messaging_thread_type:(h||(h=d("I64"))).to_int32(A),msg_ttl:E,nav_chain:void 0,nonce:void 0,offline_threading_id:w,recipient_fbids:C,send_attribution:h.to_int32(y),send_attribution_raw:void 0,view_mode:void 0,wa_group_jid:e.waGroupJid}})})})())}g.log=o}),98);
__d("MAWCommonSetupBridge",["BroadcastChannelFallback","BrowserLockManager","CurrentAppID","CurrentUser","FBLogger","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWInit","MAWJobActionsV2","MAWMIC","MAWReportSendMessageSuccessResult","MAWThreadCutover","MAWThreadUtils","MWLogSend","ODS","Promise","QPLEvent","QPLUserFlow","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WAExceededStorageQuota","WAJids","cr:2691","gkx","justknobx","pageID","performanceAbsoluteNow","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),p=new Set([25312111,25311870]),q=new Map();e=new Map([[(a=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,8],[a.MEDIA_TYPE.VIDEO,10],[a.MEDIA_TYPE.GIF,6],[a.MEDIA_TYPE.STICKER,4],[a.MEDIA_TYPE.PTT,11],[a.MEDIA_TYPE.DOCUMENT_FILE,9]]);var r=new Set([25312150,25313100,1056840931,25299294]),s=function(){return(n||(n=c("performanceAbsoluteNow")))()-Date.now()},t=s();function u(a,b,e){return(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(f){return d("MAWThreadCutover").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{is_cutover:a}},{instanceKey:e})})})}var v=/[^a-zA-Z0-9._-]/g,w=/[.]+/g,x=/[\s_.-]+/g;function y(a){return a.replace(x,".").replace(v,"").replace(w,".")}var z={broadcastChannelFallback:function(a){var b=a.event;a=a.namespace;d("BroadcastChannelFallback").handleBroadcastChannelFallbackMessage(a,b)},handleMessageSendResult:function(a){a.success&&d("MAWReportSendMessageSuccessResult").reportSendMessageSuccessResult(a.report)},log:function(a){var b=a.logLevel,c=a.logString,e=a.tags;a=e.length>0;var f=""+(d("CurrentAppID").getAppID()||"unknown");switch(b){case"count":(j||(j=d("ODS"))).bumpEntityKey(3185,y("e2ee."+(a?e.join("."):c)),y("count."+(a?c+"."+f:f)),1);o.onReadyImmediately(function(a){a=a.count;return a(c,e)});return;case"log":o.onReadyImmediately(function(a){a=a.info;return a(c,e)});return;case"warn":o.onReadyImmediately(function(a){a=a.warn;return a(c,e)});return;case"logRestricted":o.onReadyImmediately(function(a){a=a.logRestricted;return a(c,e)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;o.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,c=a.entity;a=a.key;(j||(j=d("ODS"))).bumpEntityKey(3185,c,a+"."+(d("CurrentAppID").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendAppData":var b=a.originalArgs,e=a.result;(b=b.args.contents.actions)==null||b.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||e.type!=="not_sent")return;q.set(e.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenAppData"){b=a.originalArgs.appDataExternalId;var f=q.get(b);q["delete"](b);if(f!=null&&f.type==="deleteMsgForMe"&&a.result.type==="success"){var g=f.chatJid,h=f.externalId,j=d("MAWThreadUtils").getLSThreadTypeFromJid(g);c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a.tables,g,"MAWCommonSetupBridge::sendWrittenAppData").then(function(b){d("MWLogSend").log(a,{actor:(k||(k=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:25,backend:1,hasReply:!1,messagingThreadId:k.to_string(b),offlineThreadingId:h,sendType:3,source:(l||(l=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),threadKey:b,threadType:j})}))}))}}},qplEvent:function(a){var e,f=a.action,g=a.annotations,i=a.debugInfo,j=a.error,k=a.event,l=a.instanceKey,n=a.performanceAndDateSkew,o=a.timeoutInMs;a=a.timestamp;if(!c("CurrentUser").isEmployee()&&p.has((m||(m=d("QPLEvent"))).getMarkerId(k)))return;var q=l||0;l=g==null||(e=g.string)==null?void 0:e.jid;l=l!=null?d("WAJids").validateChatJid(l):void 0;l=r.has((m||(m=d("QPLEvent"))).getMarkerId(k))&&l!=null?u(l,k,q):(h||(h=b("Promise"))).resolve();var v=a!=null&&n!=null&&c("gkx")("8334")?a+n-t+s():a;switch(f.type){case"start":c("QPLUserFlow").start(k,{annotations:babelHelpers["extends"]({},g||{},{bool:babelHelpers["extends"]({},(g==null?void 0:g.bool)||{},{isArmadilloPublicLaunchUser:c("gkx")("23405"),isDev:0,isGifSearchEnbled:!0,isLockApiSupported:c("BrowserLockManager")!=null,isRestoreDBEnabled:c("gkx")("23906"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),s_pdb:c("gkx")("8483"),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()})}),instanceKey:q,timeoutInMs:o,timestamp:v});break;case"success":c("QPLUserFlow").addAnnotations(k,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:q});l["finally"](function(){c("QPLUserFlow").endSuccess(k,{annotations:g,instanceKey:q,timestamp:v})});break;case"cancel":c("QPLUserFlow").addAnnotations(k,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:q});l["finally"](function(){c("QPLUserFlow").endCancel(k,{annotations:g,cancelReason:f.cancelReason,instanceKey:q,timestamp:v})});break;case"point":g&&c("QPLUserFlow").addAnnotations(k,g,{instanceKey:q});(m||(m=d("QPLEvent"))).getMarkerId(k)===1056839232?d("MAWMIC").addPoint(f.name,v):c("QPLUserFlow").addPoint(k,f.name,{instanceKey:q,timestamp:v});break;case"annotations":c("QPLUserFlow").addAnnotations(k,g!=null?g:{},{instanceKey:q});break;case"failure":c("QPLUserFlow").addAnnotations(k,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{failureReason:f.name}},{instanceKey:q});l["finally"](function(){c("QPLUserFlow").endFailure(k,f.name,{annotations:g,instanceKey:q,timestamp:v})});break;case"error":c("QPLUserFlow").markError(k,f.name,{debugInfo:i,error:j,instanceKey:q});break;default:throw c("FBLogger")("messenger_web").mustfixThrow("Bridge sends unreachable qplEvent action type")}}},A=function(a,b){a.push(b);return a};f=function(a){var e=a.customizeEventHandlers;a=a.worker;d("MAWInit").MAWInit.logPoint("bridge_setup_start");var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},z,e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend","mps","waapi","ebsmapi"],A,{bridgeBatcherMaxTokens:Number.MAX_SAFE_INTEGER,portalCacheSize:c("justknobx")._("3092")});e.setPort(a);if(c("gkx")("3282")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var h=d("WACrossWorkerPortal").attachPortal(g,["backend"],A,c("pageID")),i=d("WACrossWorkerPortal").attachPortal(g,["devtool","mawDbDevTool"],A,c("pageID"));d("WADevToolMessageChannel").onCreateNewChannel(function(a){h.setPort(a.port1)});i.setPort(a.port1);b("cr:2691")==null||b("cr:2691").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}d("MAWMIC").addPoint("bridge_setup_done");d("MAWInit").MAWInit.logPoint("bridge_setup_end");return f};g.MEDIA_TYPE_TO_ATTACHMENT_TYPE=e;g.initBridge=f}),98);
__d("MAWGetAttachmentTypeForSendWrittenMsg",["MAWCommonSetupBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){if(f)return 43;if(a==="revokeMsg")return 26;if(g!=null)return g;if(c)return 3;if(e&&h===!1)return 13;if(i===!0)return 13;f=b!=null?d("MAWCommonSetupBridge").MEDIA_TYPE_TO_ATTACHMENT_TYPE.get(b):null;return f!=null?f:0}g.getAttachmentTypeForSendWrittenMsg=a}),98);
__d("MAWReportSendMessageSuccessResult",["BrowserLockManager","FBLogger","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWChatJid","MAWCurrentUser","MAWFrontendMediaUtils","MAWGetAttachmentTypeForSendWrittenMsg","MAWThreadUtils","MAWVault","MAWXMAUtils","MWLogSend","MultipleTabsLogger","URLMatcher","WAJids","asyncToGeneratorRuntime","gkx","justknobx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MAWChatJid").toThreadKey(a.tables,b,"MAWCommonSetupBridge::sendWrittenMsg"));return a}catch(a){if(c("gkx")("10750")){c("FBLogger")("messenger_e2ee_web_send").warn("MAWCommonSetupBridge::sendWrittenMsg failed to get threadKey. With error: %s",a);return(h||(h=d("I64"))).zero}throw a}});return l.apply(this,arguments)}function m(a,e){var f,g=a.externalId,l=null,m=!1,n=!1;switch(a.messageType){case"editMsg":m=!0;break;case"revokeMsg":g=a.referencedExternalId;break;case"sendMsg":n=a.specialTextSize!=null;break;case"reactionMsg":l=a.reaction!=null?20:27;break;case"bumpMsg":break;case"noteReplyMsg":break;case"sendPoll":break;case"fixMe":return;default:a.messageType}var o=null;a.fileType!=null&&(o=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.fileType).mediaType);var p=a.xmaMessageType!=null,q=a.quote!=null||d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);f=c("URLMatcher").match(d("MAWVault").unvault((f=a.content)!=null?f:""));f=f!=null&&f.length>0;var r=d("MAWGetAttachmentTypeForSendWrittenMsg").getAttachmentTypeForSendWrittenMsg(a.messageType,o,n,p,m,l,q,f),s=d("MAWThreadUtils").getLSThreadTypeFromJid(a.chatJid);c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=(a==null?void 0:a.source)!=null?a.source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),i=(yield k(b,a.chatJid)),l=d("WAJids").validateGroupJid(a.chatJid);d("MWLogSend").log(b,{actor:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:r,backend:1,hasReply:q,initatingSource:a==null?void 0:a.initiatingSource,messageSendDataclass:e,messagingThreadId:h.to_string(i),msgTtl:(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec,offlineThreadingId:g,sendType:1,source:f,threadKey:i,threadType:s,waGroupJid:c("gkx")("10750")&&l!=null?d("WAJids").threadIdForChatJid(l):void 0})});return function(a){return f.apply(this,arguments)}}()))}function a(a){if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MultipleTabsLogger").hasUniqueLock()))return;m(a)}g.reportSendMessageSuccessResultFn=m;g.reportSendMessageSuccessResult=a}),98);
__d("MAWEphemeralMsgAutoResetSystemId",[],(function(a,b,c,d,e,f){"use strict";a="-111111";b=a;f["default"]=b}),66);
__d("waitForMAWMIC",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";a=new(d("WAResolvable").Resolvable)();b=a.promise;g.resolvable=a;g.promise=b}),98);
__d("MAWMICInternal",["HiddenTabDataUtils","IGDWebUtils","MAWCurrentUser","MAWMICSchema","MWQPLJoinId","MultipleTabsLogger","QPLJoinUtils","QPLUserFlow","QuickPerformanceLogger","WAGetSafeQPLError","WAGetStorageQplAnnotations","asyncToGeneratorRuntime","err","gkx","pageID","performanceNavigationStart","performanceNow","qpl","shouldUseMAWSharedWorker","waitForMAWMIC"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){return self.LockManager!=null&&self.navigator.locks instanceof self.LockManager}var l=!1,m=!1,n="unknown",o=!1,p=new Set(),q=new Map(),r=new Map(),s=new Set([(j=d("MAWMICSchema")).POINTS.ls_init_end,j.POINTS.maw_init_end,j.POINTS.process_offline_queue_end,j.POINTS.thread_mapping_end]);function a(){return s}d("IGDWebUtils").isOnInstagramWeb()&&s["delete"](d("MAWMICSchema").POINTS.thread_mapping_end);function e(){G("workerAlreadySetup",!0),s["delete"](d("MAWMICSchema").POINTS.process_offline_queue_end)}var t={download_offline_queue_end:"download_offline_queue_start",process_offline_queue_end:"process_offline_queue_start"};function u(a){m=!0;n=a;L();a=d("HiddenTabDataUtils").getHiddenTabDataForTimeInterval(0,(h||(h=c("performanceNow")))());G("isHidden",a.isHidden());H("totalHiddenTime",a.totalHiddenTime());var b=a.firstTimeHidden();b!=null&&H("firstTimeHidden",b);b=a.lastTimeHidden();b!=null&&H("lastTimeHidden",b)}function f(){return!m}function v(){return n}function w(a,b){if(m||!l)return;u("Cancel: "+a);b&&c("QPLUserFlow").markError(c("qpl")._(1056839232,"112"),"maw_ttrc_cancel_with_error",{error:b});c("QPLUserFlow").endCancel(c("qpl")._(1056839232,"112"),{annotations:{string:{cancelReason:a}}});c("QPLUserFlow").addAnnotations(c("qpl")._(29818881,"6702"),{string:{maw_cancel_reason:a,maw_error_message:b==null?void 0:b.message}})}function x(a,b){if(m)return;u("Fail: "+a);d("waitForMAWMIC").resolvable.reject(c("err")("MAWMIC Failed. Error: "+((b==null?void 0:b.message)||"")+". Reason: "+a));J("errorDescription",(b==null?void 0:b.message)||"");J("failReason",a);c("QPLUserFlow").endFailure(c("qpl")._(1056839232,"112"),a,{error:b});c("QPLUserFlow").addAnnotations(c("qpl")._(29818881,"6702"),{string:{maw_error_message:b==null?void 0:b.message,maw_fail_reason:a}})}function y(a){if(m)return;u("Drop: "+a);d("waitForMAWMIC").resolvable.reject(c("err")("MAWMIC dropped due to: "+a));J("dropReason",a);(i||(i=c("QuickPerformanceLogger"))).markerDrop(c("qpl")._(1056839232,"112"))}function z(a,b){l?E(a,b):q.has(a)||q.set(a,b!=null?b:(i||(i=c("QuickPerformanceLogger"))).currentTimestamp())}j=z;function A(){r.forEach(function(a,b){a===!0||a===!1?G(b,a):Number.isInteger(a)?H(b,Number(a)):J(b,String(a))}),r.clear()}function B(){q.forEach(function(a,b){return E(b,a)}),q.clear()}var C=function(){return document.visibilityState!==void 0?document.visibilityState==="hidden":document.hidden};function D(){if(l){o||L();return}var a=c("qpl")._(1056839232,"112");c("QPLUserFlow").startFromNavStart(a,{annotations:{bool:{isArmadilloPublicLaunchUser:c("gkx")("23405"),isInitiallyHidden:C(),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),native_locks_supported:k(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()},"int":{timeNavStart:c("performanceNavigationStart")(),timeNow:Date.now()},string:{hostname:window.location.hostname,pageID:c("pageID")}},onFlowTimeout:function(){return u("Timeout: flow timeout")}});d("MWQPLJoinId").allowJoinId&&d("QPLJoinUtils").setJoinId(i||(i=c("QuickPerformanceLogger")),a,d("MWQPLJoinId").MWQPLJoinId);L();d("MultipleTabsLogger").addAnnotationToQPLEvent(a);l=!0;n="flow_not_ended_yet";B();A()}function E(a,b){if(m)return;p.add(a);s["delete"](a);b=b!=null?{timestamp:b}:void 0;var d=t[a];d!=null&&!p.has(d)&&c("QPLUserFlow").addPoint(c("qpl")._(1056839232,"112"),d,b);c("QPLUserFlow").addPoint(c("qpl")._(1056839232,"112"),a,b);s.size===0&&F()}function F(){u("Success: flow success"),d("waitForMAWMIC").resolvable.resolve(),c("QPLUserFlow").endSuccess(c("qpl")._(1056839232,"112"))}function G(a,b){var d;if(!l){r.set(a,b);return}c("QPLUserFlow").addAnnotations(c("qpl")._(1056839232,"112"),{bool:(d={},d[a]=b,d)})}function H(a,b){var d;if(!l){r.set(a,b);return}c("QPLUserFlow").addAnnotations(c("qpl")._(1056839232,"112"),{"int":(d={},d[a]=b,d)})}function I(a,b){var d;if(!l){r.set(a,b);return}c("QPLUserFlow").addAnnotations(c("qpl")._(1056839232,"112"),{int_array:(d={},d[a]=b,d)})}function J(a,b){var d;if(!l){r.set(a,b);return}c("QPLUserFlow").addAnnotations(c("qpl")._(1056839232,"112"),{string:(d={},d[a]=b,d)})}function K(a,b){var d;if(!l){r.set(a,b);return}c("QPLUserFlow").addAnnotations(c("qpl")._(1056839232,"112"),{string_array:(d={},d[a]=b,d)})}function L(){typeof navigator!=="undefined"&&(void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){return c("QPLUserFlow").addAnnotations(c("qpl")._(1056839232,"112"),babelHelpers["extends"]({},a))}),o=!0)}function M(){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("waitForMAWMIC").resolvable.isSettled)return"pending";try{yield d("waitForMAWMIC").resolvable.promise;return"success"}catch(a){return"failure_"+d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}});return N.apply(this,arguments)}g.getRemainingRequiredEvents=a;g.onConnectToExistingWorker=e;g.duringMIC=f;g.endReasonMIC=v;g.cancel=w;g.fail=x;g.drop=y;g.addPoint=z;g.addPointOnce=j;g.startMAWMICFlow=D;g.addBoolAnnotation=G;g.addIntAnnotation=H;g.addIntArrayAnnotation=I;g.addStringAnnotation=J;g.addStringArrayAnnotation=K;g.getState=M}),98);
__d("MAWMarkMessageSendAsFailedLSDB",["LSFactory","LSMarkOptimisticMessageFailedStoredProcedure","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,d,e,g,i){return(d=g==null?void 0:g.runInTransaction(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield c("LSMarkOptimisticMessageFailedStoredProcedure")(c("LSFactory")(b),{errorMessage:e,isRetryable:i,optimisticMid:a})});return function(a){return d.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":29"))!=null?d:(h||(h=b("Promise"))).resolve()}g.markMessageSendAsFailed=a}),98);
__d("MAWMessageSendReporter",["FBLogger","MAWMarkMessageSendAsFailedLSDB","MAWReportSendMessageSuccessResult","MAWSetupWorkerAuxStateForLogging","MWLogSendToSentFailedError","QPLUserFlow","WAGetSafeQPLError","asyncToGeneratorRuntime","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h=e.qplEventType;e=e.qplInstanceKey;try{b=(yield b);if(b==null)return;if(b.success)b.value!=null?d("MAWReportSendMessageSuccessResult").reportSendMessageSuccessResultFn(b.value,g):c("QPLUserFlow").addPoint(h,"no-op",{instanceKey:e}),c("QPLUserFlow").endSuccess(h,{instanceKey:e});else{var j;g=b.error.isRetriable===!0;c("MWLogSendToSentFailedError")({qplEventType:h,qplInstanceKey:e},b.error.type,void 0,b.error.errorCode,b.error.applicationErrorCode);c("QPLUserFlow").endFailure(h,b.error.type,{annotations:{bool:{isRetriable:(j=b.error.isRetriable)!=null?j:!1,workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},"int":{errorCode:(j=b.error.errorCode)!=null?j:0},string:{details:(j=b.error.details)!=null?j:""},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});i(a,g,f)}}catch(k){c("MWLogSendToSentFailedError")({qplEventType:h,qplInstanceKey:e},"runtime-failure",k);c("QPLUserFlow").endFailure(h,"runtime-failure",{annotations:{bool:{workerTerminatedPermanently:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently},string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(k)},string_array:{worker_restart_msgs:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,worker_restart_reasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}},instanceKey:e});i(a,!1,f,k);c("FBLogger")("messenger_web").catching(k).mustfix("MAWMessageSendReporter");if(c("justknobx")._("4010")&&typeof k==="object"){b=String(k==null?void 0:k.message);j=String(k==null?void 0:k.messageParams);g=String(k==null?void 0:k.stack);c("FBLogger")("messenger_web").mustfix("Failed to send, e: %s. error params: %s. call stack: %s",b,j,g)}}});return h.apply(this,arguments)}function i(a,b,e,f){if(a==null)return;var g=a.chatJid;a=a.externalId;c("promiseDone")(d("MAWMarkMessageSendAsFailedLSDB").markMessageSendAsFailed(a,g,d("WAGetSafeQPLError").getSafeQPLErrorMessage(f),e,b))}g.MAWMessageSendReporter=a}),98);
__d("MAWMiActOnActThreadReadyWithoutValidator",["I64","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MAWMiActOnActThreadReadyInstrumentation","MAWMiActOnActThreadReadyQueue","MAWMiActThreadLifecycleState__DO_NOT_USE","MWFBLogger","Promise","asyncToGeneratorRuntime","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("MWFBLogger").MWLogger().tags(["Occam","MiActMapping"]);function m(a,b,c,d,e,f){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j){var m=d("MAWMiActOnActThreadReadyInstrumentation").getOnActThreadReadyInstanceKey(e);d("MAWMiActOnActThreadReadyInstrumentation").startQPL(m,e,b,"onActThreadReady");d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"get_thread_lifecycle_state_by_thread_key_start");j=j||(yield d("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByThreadKey(a,b,e));d("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(m,"get_thread_lifecycle_state_by_thread_key_end");d("MAWMiActOnActThreadReadyInstrumentation").addAnnotationsQPL(m,{string:{threadState:j.type}});switch(j.type){case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT:l.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Executing thread action: ",", threadState: ",", threadKey: "," on act thread ready"])),e,j.type,(k||(k=d("I64"))).to_string(b));d("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(m);return f(b,j.jid);case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:l.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[MiActMapping] Enqueue by thread key: ",", threadState: ",", threadKey: "," on act thread ready"])),e,j.type,(k||(k=d("I64"))).to_string(b));return d("MAWMiActOnActThreadReadyQueue").enqueueByThreadKey(b,f,g!=null?g:c("emptyFunction"),e,j.type,m);case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:d("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(m,"jid_missing_mi_or_mapping_state");throw l.mustfixThrow("Unhandled onActThreadReady for threadKey:%s, thread action: %s",(k||(k=d("I64"))).to_string(b),e);default:j.type;throw l.mustfixThrow(" Unreachable miActThreadState.type: %s",j.type)}});return n.apply(this,arguments)}function a(a,d,e){return new(j||(j=b("Promise")))(function(f,g){m(a,d,e,function(a,c){f({chatJid:c,serverThreadKey:a});return(j||(j=b("Promise"))).resolve()},function(a){return g(c("err")("Timed out waiting for ACT thread to be ready in %s. Thread state: %s",e,a))})["catch"](function(){return g()})})}g.onActThreadReadyWithoutValidator=m;g.waitForACTThreadReadyWithoutValidator=a}),98);
__d("MAWMiActOnActThreadReady",["MAWMIC","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MAWMiActOnActThreadReadyWithoutValidator","Promise","asyncToGeneratorRuntime","cr:7542","err","promiseDone","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g){var h=(yield d("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByThreadKey(a,c,e)),i=h.type,j=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d,g){b("cr:7542")&&(yield b("cr:7542").load().then(function(b){b=b.validateActThreadReady;return b({chatJid:g,description:e,initialMappingStateType:i,tables:a,threadKey:c})}));return f==null?void 0:f(d,g)});return function(a,b){return d.apply(this,arguments)}}();return d("MAWMiActOnActThreadReadyWithoutValidator").onActThreadReadyWithoutValidator(a,c,e,j,g,h)});return j.apply(this,arguments)}function a(a,e,f,g){return new(h||(h=b("Promise")))(function(j,k){i(a,e,f,function(a,c){j({chatJid:c,serverThreadKey:a});return(h||(h=b("Promise"))).resolve()},function(a){k(c("err")("Timed out waiting for ACT thread to be ready in %s. Thread state: %s",f,a)),c("promiseDone")(d("MAWMIC").getState().then(function(a){g!=null&&d("sendToSentQPLLogger").addSendToSentAnnotations(g,{string:{mic_state:a}})}))})["catch"](function(){return k()})})}g.onActThreadReady=i;g.waitForACTThreadReady=a}),98);